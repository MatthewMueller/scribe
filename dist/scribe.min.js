(function(){function m(n,k,u){var b=m.resolve(n);if(null==b)throw u=u||n,k=k||"root",b=Error('Failed to require "'+u+'" from "'+k+'"'),b.path=u,b.parent=k,b.require=!0,b;k=m.modules[b];k._resolving||k.exports||(u={exports:{}},u.client=u.component=!0,k._resolving=!0,k.call(this,u.exports,m.relative(b),u),delete k._resolving,k.exports=u.exports);return k.exports}m.modules={};m.aliases={};m.resolve=function(n){"/"===n.charAt(0)&&(n=n.slice(1));for(var k=[n,n+".js",n+".json",n+"/index.js",n+"/index.json"],
u=0;u<k.length;u++){n=k[u];if(m.modules.hasOwnProperty(n))return n;if(m.aliases.hasOwnProperty(n))return m.aliases[n]}};m.normalize=function(n,k){var m=[];if("."!=k.charAt(0))return k;n=n.split("/");k=k.split("/");for(var b=0;b<k.length;++b)".."==k[b]?n.pop():"."!=k[b]&&""!=k[b]&&m.push(k[b]);return n.concat(m).join("/")};m.register=function(n,k){m.modules[n]=k};m.alias=function(n,k){if(!m.modules.hasOwnProperty(n))throw Error('Failed to alias "'+n+'", it does not exist');m.aliases[k]=n};m.relative=
function(n){function k(b){var c=k.resolve(b);return m(c,n,b)}var u=m.normalize(n,"..");k.resolve=function(b){var c=b.charAt(0);if("/"==c)return b.slice(1);if("."==c)return m.normalize(u,b);var c=n.split("/"),a;a:{for(a=c.length;a--;)if("deps"===c[a])break a;a=-1}(a+=1)||(a=0);return b=c.slice(0,a+1).join("/")+"/deps/"+b};k.exists=function(b){return m.modules.hasOwnProperty(k.resolve(b))};return k};m.register("scribe/index.js",function(n,k,m){m.exports=k("./scribe").scribe});m.register("scribe/scribe.js",
function(n,k,m){m.exports=modules={};(function(){function b(){}function c(b,a){for(var d=b.length;d--;)if(b[d].listener===a)return d;return-1}function a(b){return function(){return this[b].apply(this,arguments)}}var d=b.prototype,f=this,e=f.EventEmitter;d.getListeners=function(b){var a=this._getEvents(),d,c;if(b instanceof RegExp)for(c in d={},a)a.hasOwnProperty(c)&&b.test(c)&&(d[c]=a[c]);else d=a[b]||(a[b]=[]);return d};d.flattenListeners=function(b){var a=[],d;for(d=0;d<b.length;d+=1)a.push(b[d].listener);
return a};d.getListenersAsObject=function(b){var a=this.getListeners(b),d;a instanceof Array&&(d={},d[b]=a);return d||a};d.addListener=function(b,a){var d=this.getListenersAsObject(b),f="object"===typeof a,e;for(e in d)d.hasOwnProperty(e)&&-1===c(d[e],a)&&d[e].push(f?a:{listener:a,once:!1});return this};d.on=a("addListener");d.addOnceListener=function(b,a){return this.addListener(b,{listener:a,once:!0})};d.once=a("addOnceListener");d.defineEvent=function(b){this.getListeners(b);return this};d.defineEvents=
function(b){for(var a=0;a<b.length;a+=1)this.defineEvent(b[a]);return this};d.removeListener=function(b,a){var d=this.getListenersAsObject(b),f,e;for(e in d)d.hasOwnProperty(e)&&(f=c(d[e],a),-1!==f&&d[e].splice(f,1));return this};d.off=a("removeListener");d.addListeners=function(b,a){return this.manipulateListeners(!1,b,a)};d.removeListeners=function(b,a){return this.manipulateListeners(!0,b,a)};d.manipulateListeners=function(b,a,d){var c,f,e=b?this.removeListener:this.addListener;b=b?this.removeListeners:
this.addListeners;if("object"!==typeof a||a instanceof RegExp)for(c=d.length;c--;)e.call(this,a,d[c]);else for(c in a)a.hasOwnProperty(c)&&(f=a[c])&&("function"===typeof f?e.call(this,c,f):b.call(this,c,f));return this};d.removeEvent=function(b){var a=typeof b,d=this._getEvents(),c;if("string"===a)delete d[b];else if(b instanceof RegExp)for(c in d)d.hasOwnProperty(c)&&b.test(c)&&delete d[c];else delete this._events;return this};d.removeAllListeners=a("removeEvent");d.emitEvent=function(b,a){var d=
this.getListenersAsObject(b),c,f,e,s;for(e in d)if(d.hasOwnProperty(e))for(f=d[e].length;f--;)c=d[e][f],!0===c.once&&this.removeListener(b,c.listener),s=c.listener.apply(this,a||[]),s===this._getOnceReturnValue()&&this.removeListener(b,c.listener);return this};d.trigger=a("emitEvent");d.emit=function(b){var a=Array.prototype.slice.call(arguments,1);return this.emitEvent(b,a)};d.setOnceReturnValue=function(b){this._onceReturnValue=b;return this};d._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?
this._onceReturnValue:!0};d._getEvents=function(){return this._events||(this._events={})};b.noConflict=function(){f.EventEmitter=e;return b};modules.event_emitter=b}).call(this);modules.lodash_modern_internals_isNative=function(){var b=RegExp("^"+String(Object.prototype.toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return function(c){return"function"==typeof c&&b.test(c)}}();modules.lodash_modern_internals_objectTypes={"boolean":!1,"function":!0,object:!0,
number:!1,string:!1,undefined:!1};modules.lodash_modern_objects_isObject=function(b){return function(c){return!(!c||!b[typeof c])}}(modules.lodash_modern_internals_objectTypes);modules.lodash_modern_internals_shimKeys=function(b){var c=Object.prototype.hasOwnProperty;return function(a){var d,f=[];if(!a||!b[typeof a])return f;for(d in a)c.call(a,d)&&f.push(d);return f}}(modules.lodash_modern_internals_objectTypes);modules.lodash_modern_objects_keys=function(b,c,a){var d=b(d=Object.keys)&&d;return d?
function(b){return c(b)?d(b):[]}:a}(modules.lodash_modern_internals_isNative,modules.lodash_modern_objects_isObject,modules.lodash_modern_internals_shimKeys);modules.lodash_modern_objects_defaults=function(b,c){return function(a,d,f){var e,g=a,h=g;if(!g)return h;for(var r=arguments,l=0,t="number"==typeof f?2:r.length;++l<t;)if((g=r[l])&&c[typeof g])for(var v=-1,s=c[typeof g]&&b(g),k=s?s.length:0;++v<k;)e=s[v],"undefined"==typeof h[e]&&(h[e]=g[e]);return h}}(modules.lodash_modern_objects_keys,modules.lodash_modern_internals_objectTypes);
modules.plugins_core_commands_indent=function(){return function(b){var c=new b.api.Command("indent");c.queryEnabled=function(){var a=(new b.api.Selection).getContaining(function(b){return"UL"===b.nodeName||"OL"===b.nodeName});return b.api.Command.prototype.queryEnabled.call(this)&&b.allowsBlockElements()&&!a};b.commands.indent=c}};modules.lodash_modern_utilities_noop=function(){return function(){}}();modules.lodash_modern_internals_baseCreate=function(b,c,a){function d(b,a){return c(b)?f(b):{}}var f=
b(f=Object.create)&&f;f||(d=function(){function b(){}return function(a){if(c(a)){b.prototype=a;var d=new b;b.prototype=null}return d||window.Object()}}());return d}(modules.lodash_modern_internals_isNative,modules.lodash_modern_objects_isObject,modules.lodash_modern_utilities_noop);modules.lodash_modern_internals_setBindData=function(b,c){var a={configurable:!1,enumerable:!1,value:null,writable:!1},d=function(){try{var a={},d=b(d=Object.defineProperty)&&d,c=d(a,a,a)&&d}catch(h){}return c}();return d?
function(b,c){a.value=c;d(b,"__bindData__",a)}:c}(modules.lodash_modern_internals_isNative,modules.lodash_modern_utilities_noop);modules.lodash_modern_internals_slice=function(){return function(b,c,a){c||(c=0);"undefined"==typeof a&&(a=b?b.length:0);var d=-1;a=a-c||0;for(var f=Array(0>a?0:a);++d<a;)f[d]=b[c+d];return f}}();modules.lodash_modern_internals_baseBind=function(b,c,a,d){var f=[].push;return function(e){function g(){if(r){var a=d(r);f.apply(a,arguments)}if(this instanceof g){var e=b(h.prototype),
a=h.apply(e,a||arguments);return c(a)?a:e}return h.apply(l,a||arguments)}var h=e[0],r=e[2],l=e[4];a(g,e);return g}}(modules.lodash_modern_internals_baseCreate,modules.lodash_modern_objects_isObject,modules.lodash_modern_internals_setBindData,modules.lodash_modern_internals_slice);modules.lodash_modern_internals_baseCreateWrapper=function(b,c,a,d){function f(g){function h(){var a=q?s:this;if(t){var g=d(t);e.apply(g,arguments)}if(v||n)if(g||(g=d(arguments)),v&&e.apply(g,v),n&&g.length<k)return l|=16,
f([r,E?l:l&-4,g,null,s,k]);g||(g=arguments);m&&(r=a[p]);return this instanceof h?(a=b(r.prototype),g=r.apply(a,g),c(g)?g:a):r.apply(a,g)}var r=g[0],l=g[1],t=g[2],v=g[3],s=g[4],k=g[5],q=l&1,m=l&2,n=l&4,E=l&8,p=r;a(h,g);return h}var e=[].push;return f}(modules.lodash_modern_internals_baseCreate,modules.lodash_modern_objects_isObject,modules.lodash_modern_internals_setBindData,modules.lodash_modern_internals_slice);modules.lodash_modern_objects_isFunction=function(){return function(b){return"function"==
typeof b}}();modules.lodash_modern_internals_createWrapper=function(b,c,a,d){function f(e,l,t,v,s,k){var q=l&1,n=l&4,m=l&16,E=l&32;if(!(l&2||a(e)))throw new TypeError;m&&!t.length&&(l&=-17,m=t=!1);E&&!v.length&&(l&=-33,E=v=!1);var p=e&&e.__bindData__;return p&&!0!==p?(p=d(p),p[2]&&(p[2]=d(p[2])),p[3]&&(p[3]=d(p[3])),!q||p[1]&1||(p[4]=s),!q&&p[1]&1&&(l|=8),!n||p[1]&4||(p[5]=k),m&&g.apply(p[2]||(p[2]=[]),t),E&&h.apply(p[3]||(p[3]=[]),v),p[1]|=l,f.apply(null,p)):(1==l||17===l?b:c)([e,l,t,v,s,k])}var e=
[],g=e.push,h=e.unshift;return f}(modules.lodash_modern_internals_baseBind,modules.lodash_modern_internals_baseCreateWrapper,modules.lodash_modern_objects_isFunction,modules.lodash_modern_internals_slice);modules.lodash_modern_functions_bind=function(b,c){return function(a,d){return 2<arguments.length?b(a,17,c(arguments,2),null,d):b(a,1,null,null,d)}}(modules.lodash_modern_internals_createWrapper,modules.lodash_modern_internals_slice);modules.lodash_modern_utilities_identity=function(){return function(b){return b}}();
modules.lodash_modern_support=function(b){var c=/\bthis\b/,a={};a.funcDecomp=!b(window.WinRTError)&&c.test(function(){return this});a.funcNames="string"==typeof Function.name;return a}(modules.lodash_modern_internals_isNative);modules.lodash_modern_internals_baseCreateCallback=function(b,c,a,d){var f=/^\s*function[ \n\r\t]+\w/,e=/\bthis\b/,g=Function.prototype.toString;return function(h,r,l){if("function"!=typeof h)return c;if("undefined"==typeof r||!("prototype"in h))return h;var t=h.__bindData__;
if("undefined"==typeof t&&(d.funcNames&&(t=!h.name),t=t||!d.funcDecomp,!t)){var v=g.call(h);d.funcNames||(t=!f.test(v));t||(t=e.test(v),a(h,t))}if(!1===t||!0!==t&&t[1]&1)return h;switch(l){case 1:return function(b){return h.call(r,b)};case 2:return function(b,a){return h.call(r,b,a)};case 3:return function(b,a,d){return h.call(r,b,a,d)};case 4:return function(b,a,d,c){return h.call(r,b,a,d,c)}}return b(h,r)}}(modules.lodash_modern_functions_bind,modules.lodash_modern_utilities_identity,modules.lodash_modern_internals_setBindData,
modules.lodash_modern_support);modules.lodash_modern_objects_forIn=function(b,c){return function(a,d,f){var e;if(!a||!c[typeof a])return a;d=d&&"undefined"==typeof f?d:b(d,f,3);for(e in a)if(!1===d(a[e],e,a))break;return a}}(modules.lodash_modern_internals_baseCreateCallback,modules.lodash_modern_internals_objectTypes);modules.lodash_modern_internals_arrayPool=[];modules.lodash_modern_internals_getArray=function(b){return function(){return b.pop()||[]}}(modules.lodash_modern_internals_arrayPool);
modules.lodash_modern_internals_maxPoolSize=40;modules.lodash_modern_internals_releaseArray=function(b,c){return function(a){a.length=0;b.length<c&&b.push(a)}}(modules.lodash_modern_internals_arrayPool,modules.lodash_modern_internals_maxPoolSize);modules.lodash_modern_internals_baseIsEqual=function(b,c,a,d,f){function e(q,p,u,C,y,z){if(u){var A=u(q,p);if("undefined"!=typeof A)return!!A}if(q===p)return 0!==q||1/q==1/p;if(q===q&&!(q&&d[typeof q]||p&&d[typeof p]))return!1;if(null==q||null==p)return q===
p;var x=m.call(q),B=m.call(p);x==g&&(x=v);B==g&&(B=v);if(x!=B)return!1;switch(x){case r:case l:return+q==+p;case t:return q!=+q?p!=+p:0==q?1/q==1/p:q==+p;case s:case k:return q==String(p)}B=x==h;if(!B){var w=n.call(q,"__wrapped__"),F=n.call(p,"__wrapped__");if(w||F)return e(w?q.__wrapped__:q,F?p.__wrapped__:p,u,C,y,z);if(x!=v)return!1;x=q.constructor;w=p.constructor;if(x!=w&&!(a(x)&&x instanceof x&&a(w)&&w instanceof w)&&"constructor"in q&&"constructor"in p)return!1}x=!y;y||(y=c());z||(z=c());for(w=
y.length;w--;)if(y[w]==q)return z[w]==p;var D=0,A=!0;y.push(q);z.push(p);if(B){if(w=q.length,D=p.length,(A=D==w)||C)for(;D--;)if(B=w,F=p[D],C)for(;B--&&!(A=e(q[B],F,u,C,y,z)););else if(!(A=e(q[D],F,u,C,y,z)))break}else b(p,function(b,a,d){if(n.call(d,a))return D++,A=n.call(q,a)&&e(q[a],b,u,C,y,z)}),A&&!C&&b(q,function(b,a,d){if(n.call(d,a))return A=-1<--D});y.pop();z.pop();x&&(f(y),f(z));return A}var g="[object Arguments]",h="[object Array]",r="[object Boolean]",l="[object Date]",t="[object Number]",
v="[object Object]",s="[object RegExp]",k="[object String]",q=Object.prototype,m=q.toString,n=q.hasOwnProperty;return e}(modules.lodash_modern_objects_forIn,modules.lodash_modern_internals_getArray,modules.lodash_modern_objects_isFunction,modules.lodash_modern_internals_objectTypes,modules.lodash_modern_internals_releaseArray);modules.lodash_modern_utilities_property=function(){return function(b){return function(c){return c[b]}}}();modules.lodash_modern_functions_createCallback=function(b,c,a,d,f){return function(e,
g,h){var r=typeof e;if(null==e||"function"==r)return b(e,g,h);if("object"!=r)return f(e);var l=d(e),t=l[0],v=e[t];return 1!=l.length||v!==v||a(v)?function(b){for(var a=l.length,d=!1;a--&&(d=c(b[l[a]],e[l[a]],null,!0)););return d}:function(a){a=a[t];return v===a&&(0!==v||1/v==1/a)}}}(modules.lodash_modern_internals_baseCreateCallback,modules.lodash_modern_internals_baseIsEqual,modules.lodash_modern_objects_isObject,modules.lodash_modern_objects_keys,modules.lodash_modern_utilities_property);modules.lodash_modern_arrays_last=
function(b,c){var a=Math.max;return function(d,f,e){var g=0,h=d?d.length:0;if("number"!=typeof f&&null!=f){var r=h;for(f=b(f,e,3);r--&&f(d[r],r,d);)g++}else if(g=f,null==g||e)return d?d[h-1]:void 0;return c(d,a(0,h-g))}}(modules.lodash_modern_functions_createCallback,modules.lodash_modern_internals_slice);modules.lodash_modern_internals_baseIndexOf=function(){return function(b,c,a){a=(a||0)-1;for(var d=b?b.length:0;++a<d;)if(b[a]===c)return a;return-1}}();modules.lodash_modern_objects_forOwn=function(b,
c,a){return function(d,f,e){if(!d||!a[typeof d])return d;f=f&&"undefined"==typeof e?f:b(f,e,3);for(var g=-1,h=a[typeof d]&&c(d),r=h?h.length:0;++g<r&&(e=h[g],!1!==f(d[e],e,d)););return d}}(modules.lodash_modern_internals_baseCreateCallback,modules.lodash_modern_objects_keys,modules.lodash_modern_internals_objectTypes);modules.lodash_modern_objects_isArray=function(b){var c=Object.prototype.toString,a=b(a=Array.isArray)&&a;return a||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&
"[object Array]"==c.call(a)||!1}}(modules.lodash_modern_internals_isNative);modules.lodash_modern_objects_isString=function(){var b=Object.prototype.toString;return function(c){return"string"==typeof c||c&&"object"==typeof c&&"[object String]"==b.call(c)||!1}}();modules.lodash_modern_collections_contains=function(b,c,a,d){var f=Math.max;return function(e,g,h){var r=-1,l=e?e.length:0,t=!1;h=(0>h?f(0,l+h):h)||0;a(e)?t=-1<b(e,g,h):"number"==typeof l?t=-1<(d(e)?e.indexOf(g,h):b(e,g,h)):c(e,function(a){if(++r>=
h)return!(t=a===g)});return t}}(modules.lodash_modern_internals_baseIndexOf,modules.lodash_modern_objects_forOwn,modules.lodash_modern_objects_isArray,modules.lodash_modern_objects_isString);modules.plugins_core_commands_insert_html=function(b,c){return function(){return function(a){var d="P LI DIV BLOCKQUOTE UL OL H2".split(" "),f=new a.api.Command("insertHTML");f.execute=function(f){a.allowsBlockElements()?a.transactionManager.run(function(){function g(a){Array.prototype.reduce.call(a.childNodes,
function(a,f){var e=b(a);e?c(d,e[0].nodeName)===c(d,f.nodeName)?e.push(f):a.push([f]):a.push([f]);return a},[]).filter(function(a){return!c(d,a[0].nodeName)}).forEach(function(a){var b=document.createElement("p");a[0].parentNode.insertBefore(b,a[0]);a.forEach(function(a){b.appendChild(a)})});a._isWrapped=!0}function h(a){for(var b=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT),d=b.firstChild();d;){if("BLOCKQUOTE"===d.nodeName&&!d._isWrapped){g(d);h(a);break}d=b.nextSibling()}}var r=document.createElement("div");
r.innerHTML=f;g(r);h(r);a.api.Command.prototype.execute.call(this,r.innerHTML)}.bind(this)):a.api.Command.prototype.execute.call(this,f)};a.commands.insertHTML=f}}}(modules.lodash_modern_arrays_last,modules.lodash_modern_collections_contains);modules.plugins_core_commands_insert_list=function(){return function(b){var c=function(a){b.api.Command.call(this,a)};c.prototype=Object.create(b.api.Command.prototype);c.prototype.constructor=c;c.prototype.execute=function(a){function d(a){if(0<a.length){var b=
document.createElement(g.nodeName);a.forEach(function(a){b.appendChild(a)});g.parentNode.insertBefore(b,g.nextElementSibling)}}if(this.queryState()){var c=new b.api.Selection,e=c.range,g=c.getContaining(function(a){return"OL"===a.nodeName||"UL"===a.nodeName}),h=c.getContaining(function(a){return"LI"===a.nodeName});b.transactionManager.run(function(){if(h){var a=(new b.api.Node(h)).nextAll();d(a);c.placeMarkers();a=document.createElement("p");a.innerHTML=h.innerHTML;g.parentNode.insertBefore(a,g.nextElementSibling);
h.parentNode.removeChild(h)}else{var a=Array.prototype.map.call(g.querySelectorAll("li"),function(a){return e.intersectsNode(a)&&a}).filter(function(a){return a}),l=a.slice(-1)[0],l=(new b.api.Node(l)).nextAll();d(l);c.placeMarkers();var k=document.createDocumentFragment();a.forEach(function(a){var b=document.createElement("p");b.innerHTML=a.innerHTML;k.appendChild(b)});g.parentNode.insertBefore(k,g.nextElementSibling);a.forEach(function(a){a.parentNode.removeChild(a)})}0===g.childNodes.length&&g.parentNode.removeChild(g);
c.selectMarkers()}.bind(this))}else b.api.Command.prototype.execute.call(this,a)};c.prototype.queryEnabled=function(){return b.api.Command.prototype.queryEnabled.call(this)&&b.allowsBlockElements()};b.commands.insertOrderedList=new c("insertOrderedList");b.commands.insertUnorderedList=new c("insertUnorderedList")}};modules.plugins_core_commands_outdent=function(){return function(b){var c=new b.api.Command("outdent");c.queryEnabled=function(){var a=(new b.api.Selection).getContaining(function(a){return"UL"===
a.nodeName||"OL"===a.nodeName});return b.api.Command.prototype.queryEnabled.call(this)&&b.allowsBlockElements()&&!a};b.commands.outdent=c}};modules.plugins_core_commands_redo=function(){return function(b){var c=new b.api.Command("redo");c.execute=function(){var a=b.undoManager.redo();"undefined"!==typeof a&&b.restoreFromHistory(a)};c.queryEnabled=function(){return b.undoManager.position<b.undoManager.stack.length-1};b.commands.redo=c;b.el.addEventListener("keydown",function(a){a.shiftKey&&(a.metaKey||
a.ctrlKey)&&90===a.keyCode&&(a.preventDefault(),c.execute())})}};modules.plugins_core_commands_undo=function(){return function(b){var c=new b.api.Command("undo");c.execute=function(){var a=b.undoManager.undo();"undefined"!==typeof a&&b.restoreFromHistory(a)};c.queryEnabled=function(){return 1<b.undoManager.position};b.commands.undo=c;b.el.addEventListener("keydown",function(a){a.shiftKey||!a.metaKey&&!a.ctrlKey||90!==a.keyCode||(a.preventDefault(),c.execute())})}};modules.plugins_core_commands={indent:modules.plugins_core_commands_indent,
insertHTML:modules.plugins_core_commands_insert_html,insertList:modules.plugins_core_commands_insert_list,outdent:modules.plugins_core_commands_outdent,redo:modules.plugins_core_commands_redo,undo:modules.plugins_core_commands_undo};modules.plugins_core_events=function(b){return function(){return function(c){c.allowsBlockElements()&&c.el.addEventListener("keydown",function(a){if(13===a.keyCode){var b=new c.api.Selection,f=b.range,e=b.getContaining(function(a){return/^(H[1-6])$/.test(a.nodeName)});
if(e&&f.collapsed){var g=f.cloneRange();g.setEndAfter(e,0);""===g.cloneContents().firstChild.textContent&&(a.preventDefault(),c.transactionManager.run(function(){var a=document.createElement("p"),c=document.createElement("br");a.appendChild(c);e.parentNode.insertBefore(a,e.nextElementSibling);f.setStart(a,0);f.setEnd(a,0);b.selection.removeAllRanges();b.selection.addRange(f)}))}}});c.allowsBlockElements()&&c.el.addEventListener("keydown",function(a){if(13===a.keyCode||8===a.keyCode){var b=new c.api.Selection;
if(b.range.collapsed){var f=b.getContaining(function(a){return"LI"===a.nodeName});f&&""===f.textContent.trim()&&(a.preventDefault(),a=b.getContaining(function(a){return"UL"===a.nodeName||"OL"===a.nodeName}),c.getCommand("OL"===a.nodeName?"insertOrderedList":"insertUnorderedList").execute())}}});c.el.addEventListener("paste",function(a){if(a.clipboardData)a.preventDefault(),b(a.clipboardData.types,"text/html")?c.insertHTML(a.clipboardData.getData("text/html")):c.insertPlainText(a.clipboardData.getData("text/plain"));
else{var d=new c.api.Selection;d.placeMarkers();var f=document.createElement("div");document.body.appendChild(f);f.setAttribute("contenteditable",!0);f.focus();setTimeout(function(){data=f.innerHTML;f.parentNode.removeChild(f);d.selectMarkers();c.el.focus();c.insertHTML(data)},1)}})}}}(modules.lodash_modern_collections_contains);modules.plugins_core_formatters_html_replace_nbsp_chars=function(){return function(b){var c=RegExp("&nbsp;|\u00a0","g");b.htmlFormatter.formatters.push(function(a){return a.replace(c,
" ")})}};modules.lodash_modern_internals_htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};modules.lodash_modern_internals_escapeHtmlChar=function(b){return function(c){return b[c]}}(modules.lodash_modern_internals_htmlEscapes);modules.lodash_modern_internals_reUnescapedHtml=RegExp("["+(0,modules.lodash_modern_objects_keys)(modules.lodash_modern_internals_htmlEscapes).join("")+"]","g");modules.lodash_modern_utilities_escape=function(b,c,a){return function(d){return null==d?
"":String(d).replace(a,b)}}(modules.lodash_modern_internals_escapeHtmlChar,modules.lodash_modern_objects_keys,modules.lodash_modern_internals_reUnescapedHtml);modules.plugins_core_formatters_plain_text_escape_html_characters=function(b){return function(){return function(c){c.plainTextFormatter.formatters.push(b)}}}(modules.lodash_modern_utilities_escape);modules.plugins_core_inline_elements_mode=function(){return function(){return function(b){b.el.addEventListener("keydown",function(c){if(13===c.keyCode){var a=
new b.api.Selection,d=a.range;a.getContaining(function(a){return"LI"===a.nodeName||/^(H[1-6])$/.test(a.nodeName)})||(c.preventDefault(),b.transactionManager.run(function(){"BR"===b.el.lastChild.nodeName&&b.el.removeChild(b.el.lastChild);var c=document.createElement("br");d.insertNode(c);d.collapse(!1);var e=d.cloneRange();e.setEndAfter(b.el.lastChild,0);e=e.cloneContents();a:{for(e=document.createTreeWalker(e);e.nextNode();)if(e.currentNode&&(~["br"].indexOf(e.currentNode.nodeName.toLowerCase())||
0<e.currentNode.length)){e=!0;break a}e=!1}e||(e=document.createElement("br"),d.insertNode(e));e=d.cloneRange();e.setStartAfter(c,0);e.setEndAfter(c,0);a.selection.removeAllRanges();a.selection.addRange(e)}))}}.bind(this));""===b.getHTML().trim()&&b.setContent("")}}}();modules.plugins_core_patches_commands_bold=function(){return function(b){var c=new b.api.CommandPatch("bold");c.queryEnabled=function(){var a=(new b.api.Selection).getContaining(function(a){return/^(H[1-6])$/.test(a.nodeName)});return b.api.CommandPatch.prototype.queryEnabled.apply(this,
arguments)&&!a};b.commandPatches.bold=c}};modules.plugins_core_patches_commands_indent=function(){return function(){return function(b){var c=new b.api.CommandPatch("indent");c.execute=function(a){b.transactionManager.run(function(){var d=new b.api.Selection,c=d.range;if("P"===c.commonAncestorContainer.nodeName&&"<br>"===c.commonAncestorContainer.innerHTML){var e=document.createTextNode("\ufeff");c.insertNode(e);c.setStart(e,0);c.setEnd(e,0);d.selection.removeAllRanges();d.selection.addRange(c)}b.api.CommandPatch.prototype.execute.call(this,
a);d=new b.api.Selection;(d=d.getContaining(function(a){return"BLOCKQUOTE"===a.nodeName}))&&d.removeAttribute("style")}.bind(this))};b.commandPatches.indent=c}}}();modules.plugins_core_patches_commands_insert_html=function(){return function(b){var c=new b.api.CommandPatch("insertHTML");c.execute=function(a){b.transactionManager.run(function(){function d(a){var c=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT),g=c.firstChild();if(g){do"SPAN"===g.nodeName?(new b.api.Element(a)).unwrap(g):(g.style.lineHeight=
null,""===g.getAttribute("style")&&g.removeAttribute("style")),d(g);while(g=c.nextSibling())}}b.api.CommandPatch.prototype.execute.call(this,a);d(b.el)}.bind(this))};b.commandPatches.insertHTML=c}};modules.plugins_core_patches_commands_insert_list=function(){return function(b){var c=function(a){b.api.CommandPatch.call(this,a)};c.prototype=Object.create(b.api.CommandPatch.prototype);c.prototype.constructor=c;c.prototype.execute=function(a){b.transactionManager.run(function(){b.api.CommandPatch.prototype.execute.call(this,
a);if(this.queryState()){var d=new b.api.Selection,c=d.getContaining(function(a){return"OL"===a.nodeName||"UL"===a.nodeName});if(c){var e=c.parentNode;e&&/^(H[1-6]|P)$/.test(e.nodeName)&&(d.placeMarkers(),e.parentNode.insertBefore(c,e.nextElementSibling),d.selectMarkers(),e.parentNode.removeChild(e))}Array.prototype.slice.call(c.childNodes).forEach(function(a){Array.prototype.slice.call(a.childNodes).forEach(function(d){"SPAN"===d.nodeName?(new b.api.Element(a)).unwrap(d):d.nodeType===Node.ELEMENT_NODE&&
(d.style.lineHeight=null,""===d.getAttribute("style")&&d.removeAttribute("style"))})})}}.bind(this))};b.commandPatches.insertOrderedList=new c("insertOrderedList");b.commandPatches.insertUnorderedList=new c("insertUnorderedList")}};modules.plugins_core_patches_commands_outdent=function(){return function(b){var c=new b.api.CommandPatch("outdent");c.execute=function(){b.transactionManager.run(function(){var a=new b.api.Selection,d=a.range;if("BLOCKQUOTE"===d.commonAncestorContainer.nodeName){var c=
d.commonAncestorContainer;a.placeMarkers();a.selectMarkers(!0);var e=d.cloneContents();c.parentNode.insertBefore(e,c);d.deleteContents();a.selectMarkers();""===c.textContent&&c.parentNode.removeChild(c)}else if(d=a.getContaining(function(a){return"P"===a.nodeName})){c=a.getContaining(function(a){return"BLOCKQUOTE"===a.nodeName});e=(new b.api.Node(d)).nextAll();if(e.length){var g=document.createElement(c.nodeName);e.forEach(function(a){g.appendChild(a)});c.parentNode.insertBefore(g,c.nextElementSibling)}a.placeMarkers();
c.parentNode.insertBefore(d,c.nextElementSibling);a.selectMarkers();""===c.innerHTML&&c.parentNode.removeChild(c)}else b.api.CommandPatch.prototype.execute.call(this)}.bind(this))};b.commandPatches.outdent=c}};modules.plugins_core_patches_empty_when_deleting=function(){return function(b){function c(a){var b=document.createElement("div");a=a.cloneContents();b.appendChild(a);return b.innerHTML}function a(a){a=c(a);var f=document.createRange();f.selectNodeContents(b.el);f=c(f);return a===f}b.el.addEventListener("keydown",
function(c){if(8===c.keyCode||46===c.keyCode){var f=new b.api.Selection,e=f.selection.isCollapsed,g=a(f.range);if(e&&""===b.getTextContent().trim()||!e&&g)c.preventDefault(),b.transactionManager.run(function(){b.setHTML('<p><em class="scribe-marker"></em><br></p>');f.selectMarkers()})}})}};modules.plugins_core_patches_events=function(){return function(b){b.allowsBlockElements()&&b.el.addEventListener("keyup",function(c){if(8===c.keyCode||46===c.keyCode){var a=new b.api.Selection,d=a.getContaining(function(a){return"P"===
a.nodeName});d&&(b.undoManager.undo(),b.transactionManager.run(function(){a.placeMarkers();Array.prototype.slice.call(d.childNodes).forEach(function(a){"SPAN"===a.nodeName?(new b.api.Element(d)).unwrap(a):a.nodeType===Node.ELEMENT_NODE&&(a.style.lineHeight=null,""===a.getAttribute("style")&&a.removeAttribute("style"))});a.selectMarkers()}))}})}};modules.plugins_core_patches={commands:{bold:modules.plugins_core_patches_commands_bold,indent:modules.plugins_core_patches_commands_indent,insertHTML:modules.plugins_core_patches_commands_insert_html,
insertList:modules.plugins_core_patches_commands_insert_list,outdent:modules.plugins_core_patches_commands_outdent},emptyWhenDeleting:modules.plugins_core_patches_empty_when_deleting,events:modules.plugins_core_patches_events};modules.plugins_core_set_root_p_element=function(){return function(b){""===b.getHTML().trim()&&b.setContent("<p><br></p>")}};modules.api_command_patch=function(b){function c(a){this.commandName=a}c.prototype.execute=function(a){b.transactionManager.run(function(){document.execCommand(this.commandName,
!1,a||null)}.bind(this))};c.prototype.queryState=function(){return document.queryCommandState(this.commandName)};c.prototype.queryEnabled=function(){return document.queryCommandEnabled(this.commandName)};return c};modules.api_command=function(b){function c(a){this.commandName=a;this.patch=b.commandPatches[this.commandName]}c.prototype.execute=function(a){this.patch?this.patch.execute(a):b.transactionManager.run(function(){document.execCommand(this.commandName,!1,a||null)}.bind(this))};c.prototype.queryState=
function(){return this.patch?this.patch.queryState():document.queryCommandState(this.commandName)};c.prototype.queryEnabled=function(){return this.patch?this.patch.queryEnabled():document.queryCommandEnabled(this.commandName)};return c};modules.api_node=function(){function b(b){this.node=b}b.prototype.getAncestor=function(b){var a=function(a){return a&&a.attributes&&a.attributes.getNamedItem("contenteditable")};if(!a(this.node))for(var d=this.node.parentNode;d&&!a(d);){if(b(d))return d;d=d.parentNode}};
b.prototype.nextAll=function(){for(var b=[],a=this.node;a=a.nextSibling;)b.push(a);return b};return b}();modules.api_element=function(b){function c(a){b.call(this,a)}c.prototype=Object.create(b.prototype);c.prototype.constructor=c;c.prototype.unwrap=function(a){for(;0<a.childNodes.length;)this.node.insertBefore(a.childNodes[0],a);this.node.removeChild(a)};return c}(modules.api_node);modules.api_selection=function(b){function c(){this.selection=window.getSelection();this.selection.rangeCount&&(this.range=
this.selection.getRangeAt(0))}c.prototype.getContaining=function(a){var c=new b.api.Node(this.range.commonAncestorContainer);return c.node&&c.node.attributes&&c.node.attributes.getNamedItem("contenteditable")||!a(c.node)?c.getAncestor(a):c.node};c.prototype.placeMarkers=function(){var a=document.createElement("em");a.classList.add("scribe-marker");var b=document.createElement("em");b.classList.add("scribe-marker");var c=this.range.cloneRange();c.collapse(!1);c.insertNode(b);b.nextSibling&&3===b.nextSibling.nodeType&&
""===b.nextSibling.data&&b.parentNode.removeChild(b.nextSibling);this.range.collapsed||(b=this.range.cloneRange(),b.collapse(!0),b.insertNode(a),a.nextSibling&&3===a.nextSibling.nodeType&&""===a.nextSibling.data&&a.parentNode.removeChild(a.nextSibling));this.selection.removeAllRanges();this.selection.addRange(this.range)};c.prototype.getMarkers=function(){return b.el.querySelectorAll("em.scribe-marker")};c.prototype.removeMarkers=function(){var a=this.getMarkers();Array.prototype.forEach.call(a,function(a){a.parentNode.removeChild(a)})};
c.prototype.selectMarkers=function(a){var b=this.getMarkers();b.length&&(this.range.setStartBefore(b[0]),2<=b.length?this.range.setEndAfter(b[1]):this.range.setEndAfter(b[0]),a||this.removeMarkers(),this.selection.removeAllRanges(),this.selection.addRange(this.range))};c.prototype.isCaretOnNewLine=function(){var a=this.getContaining(function(a){return"P"===a.nodeName});if(a){var b=a.innerHTML.trim();return"P"===a.nodeName&&("<br>"===b||""===b)}return!1};return c};modules.api_simple_command=function(b,
c){function a(a,b){c.api.Command.call(this,a);this.nodeName=b}a.prototype=Object.create(b.Command.prototype);a.prototype.constructor=a;a.prototype.queryState=function(){var a=new c.api.Selection;return c.api.Command.prototype.queryState.call(this)&&!!a.getContaining(function(a){return a.nodeName===this.nodeName}.bind(this))};return a};modules.api=function(b,c,a,d,f,e){return function(g){this.CommandPatch=b(g);this.Command=c(g);this.Element=a;this.Node=d;this.Selection=f(g);this.SimpleCommand=e(this,
g)}}(modules.api_command_patch,modules.api_command,modules.api_element,modules.api_node,modules.api_selection,modules.api_simple_command);modules.lodash_modern_objects_assign=function(b,c,a){return function(d,f,e){var g,h=d,k=h;if(!h)return k;var l=arguments,n=0,m="number"==typeof e?2:l.length;if(3<m&&"function"==typeof l[m-2])var s=b(l[--m-1],l[m--],2);else 2<m&&"function"==typeof l[m-1]&&(s=l[--m]);for(;++n<m;)if((h=l[n])&&a[typeof h])for(var u=-1,q=a[typeof h]&&c(h),H=q?q.length:0;++u<H;)g=q[u],
k[g]=s?s(k[g],h[g]):h[g];return k}}(modules.lodash_modern_internals_baseCreateCallback,modules.lodash_modern_objects_keys,modules.lodash_modern_internals_objectTypes);modules.transaction_manager=function(b){return function(c){function a(){this.history=[]}b(a.prototype,{start:function(){this.history.push(1)},end:function(){this.history.pop();0===this.history.length&&(c.pushHistory(),c.trigger("content-changed"))},run:function(a){this.start();try{a&&a()}finally{this.end()}}});return a}}(modules.lodash_modern_objects_assign);
modules.undo_manager=function(b){function c(){this.position=0;this.stack=[];this.debug=b.isDebugModeEnabled()}c.prototype.maxStackSize=100;c.prototype.push=function(a){this.debug&&console.log("UndoManager.push: %s",a);this.stack.length=++this.position;for(this.stack.push(a);this.stack.length>this.maxStackSize;)this.stack.shift(),--this.position};c.prototype.undo=function(){if(1<this.position)return this.stack[--this.position]};c.prototype.redo=function(){if(this.position<this.stack.length-1)return this.stack[++this.position]};
return c};modules.scribe=function(b,c,a,d,f,e,g,h,k,l,m,n){function s(b,s){this.el=b;this.commands={};this.options=c(s||{},{allowBlockElements:!0,debug:!1});this.commandPatches={};this.plainTextFormatter=new u;this.htmlFormatter=new u;this.api=new l(this);this.transactionManager=new (m(this));this.undoManager=new (n(this));this.el.setAttribute("contenteditable",!0);this.el.addEventListener("input",function(){this.transactionManager.run()}.bind(this),!1);this.allowsBlockElements()?this.use(k()):this.use(g());
this.use(e());this.use(f());this.use(h.commands.bold());this.use(h.commands.indent());this.use(h.commands.insertHTML());this.use(h.commands.insertList());this.use(h.commands.outdent());this.allowsBlockElements()&&this.use(h.emptyWhenDeleting());this.use(h.events());this.use(a.indent());this.use(a.insertHTML());this.use(a.insertList());this.use(a.outdent());this.use(a.redo());this.use(a.undo());this.use(d());var G=function(){setTimeout(function(){this.pushHistory()}.bind(this),0);this.el.removeEventListener("focus",
G)}.bind(this);this.el.addEventListener("focus",function(){function a(b){b=document.createTreeWalker(b);var c=b.currentNode;return b.firstChild()?"BR"===b.currentNode.nodeName?c:a(b.currentNode):b.currentNode}var b=new this.api.Selection;if(b.range){b.placeMarkers();var c=this.allowsBlockElements()&&this.getHTML().match(/^<em class="scribe-marker"><\/em>/);b.removeMarkers();if(c){var c=a(this.el.firstChild),d=b.range;d.setStart(c,0);d.setEnd(c,0);b.selection.removeAllRanges();b.selection.addRange(d)}}}.bind(this));
this.el.addEventListener("focus",G)}function u(){this.formatters=[]}s.prototype=Object.create(b.prototype);s.prototype.use=function(a){a(this);return this};s.prototype.setHTML=function(a){this.el.innerHTML=a};s.prototype.getHTML=function(){return this.el.innerHTML};s.prototype.getContent=function(){return this.getHTML().replace(/<br>$/,"")};s.prototype.getTextContent=function(){return this.el.textContent};s.prototype.pushHistory=function(){var a=this.undoManager.stack[this.undoManager.position],b=
a&&a.replace(/<em class="scribe-marker">/g,"").replace(/<\/em>/g,"");return!a||a&&this.getContent()!==b?(a=new this.api.Selection,a.placeMarkers(),b=this.getHTML(),a.removeMarkers(),this.undoManager.push(b),!0):!1};s.prototype.getCommand=function(a){return this.commands[a]||this.commandPatches[a]||new this.api.Command(a)};s.prototype.restoreFromHistory=function(a){this.setHTML(a);(new this.api.Selection).selectMarkers();this.trigger("content-changed")};s.prototype.allowsBlockElements=function(){return this.options.allowBlockElements};
s.prototype.setContent=function(a){this.allowsBlockElements()||(a+="<br>");this.setHTML(this.htmlFormatter.format(a));this.trigger("content-changed")};s.prototype.insertPlainText=function(a){this.insertHTML("<p>"+this.plainTextFormatter.format(a)+"</p>")};s.prototype.insertHTML=function(a){this.getCommand("insertHTML").execute(this.htmlFormatter.format(a))};s.prototype.isDebugModeEnabled=function(){return this.options.debug};u.prototype.format=function(a){return this.formatters.reduce(function(a,
b){return b(a)},a)};return s}(modules.event_emitter,modules.lodash_modern_objects_defaults,modules.plugins_core_commands,modules.plugins_core_events,modules.plugins_core_formatters_html_replace_nbsp_chars,modules.plugins_core_formatters_plain_text_escape_html_characters,modules.plugins_core_inline_elements_mode,modules.plugins_core_patches,modules.plugins_core_set_root_p_element,modules.api,modules.transaction_manager,modules.undo_manager)});m.alias("scribe/index.js","scribe/index.js");"object"==
typeof exports?module.exports=m("scribe"):"function"==typeof define&&define.amd?define([],function(){return m("scribe")}):this.scribe=m("scribe")})();
